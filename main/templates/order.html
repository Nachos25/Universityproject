<!DOCTYPE html>
{% load static %}
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Оформлення покупки</title>
  <link rel="stylesheet" href="{% static 'main/css/style-order.css'%}">
</head>
<body>

<div class="checkout-form">
  <h2>Дані для оформлення покупки</h2>
  <form action="/order" method="post">
    {% csrf_token %}
    <input type="hidden" name="goods" class="goods">
    <input type="hidden" name="buying_method" class="buying_method">
    <input type="hidden" name="price" class="price">
    <div class="form-group">
      <label for="email">Електронна пошта:</label>
      <input type="email" id="email" value="{{user.email}}" name="email" required>
    </div>
    <div class="form-group">
      <label for="phone">Номер телефону:</label>
      <input type="tel" id="phone" name="phone" required>
    </div>
    <div class="form-group">
      <label for="fullname">Повне ім'я:</label>
      <input type="text" value="{{user.first_name}} {{user.last_name}}" id="fullname" name="fullname" required>
    </div>
    <div class="additional-fields">
      <h3>Інші дані для замовлення</h3>
      <div class="form-group">
        <label for="region">Область:</label>
        <input type="text" id="region" name="region">
      </div>
      <div class="form-group">
        <label for="city">Місто проживання:</label>
        <input type="text" id="city" name="city">
      </div>
      <div class="form-group">
        <label for="payment-method">Спосіб оплати:</label>
        <select id="payment-method" name="payment_method">
          <option value="card">Карткою</option>
          <option value="cash">Готівкою</option>
          <option value="paypal">PayPal</option>
        </select>
      </div>
    </div>
    <button type="submit" class="buy_button">Оформити замовлення</button>
  </form>
</div>
      <script>
        let buy_button = document.querySelector(".buy_button")
        let price = 0
        let jsonCart = JSON.parse(localStorage.getItem('cart'))
        for(let i = 0; i<jsonCart.length; i++){
          price += parseInt(JSON.parse(jsonCart[i]).price.replace(' ', ''))
        }
        document.querySelector(".price").value = price
        buy_button.addEventListener('click', function() {
            document.querySelector('.goods').value = jsonCart
            document.querySelector(".buying_method").value = "{{text_param}}"
            localStorage.removeItem('cart')
            localStorage.removeItem('cart_length')
        });
      </script>
</body>
</html>